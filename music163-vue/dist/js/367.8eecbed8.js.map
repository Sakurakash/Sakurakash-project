{"version":3,"file":"js/367.8eecbed8.js","mappings":"oKAAA,IAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,YAAY,UAAU,CAACF,EAAG,aAAa,CAACG,IAAI,cAAc,CAACH,EAAG,KAAK,CAACE,YAAY,gBAAgBJ,EAAIM,GAAIN,EAAIO,MAAM,SAASC,EAAIC,GAAO,OAAOP,EAAG,KAAK,CAACM,IAAIC,EAAMJ,IAAI,QAAQK,UAAS,EAAKN,YAAY,cAAc,CAACF,EAAG,KAAK,CAACE,YAAY,eAAe,CAACJ,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIa,KAAKJ,OAAWP,EAAG,KAAKF,EAAIM,GAAIN,EAAIO,KAAKE,IAAQ,UAAS,GAACK,EAAE,UAAEC,EAAS,KAAEC,IAAO,OAAOd,EAAG,KAAK,CAACM,IAAIM,EAAGV,YAAY,aAAaa,GAAG,CAAC,MAAQ,SAASC,GAAiC,OAAzBA,EAAOC,kBAAyBnB,EAAIoB,aAAaN,EAAG,IAAI,CAACZ,EAAG,MAAM,CAACmB,WAAW,CAAC,CAACL,KAAK,OAAOM,QAAQ,SAASC,MAAOR,EAAWS,WAAW,cAAcC,MAAM,CAAC,IAAM,MAAMvB,EAAG,IAAI,CAACF,EAAIW,GAAGX,EAAIY,GAAGI,OAAU,IAAG,IAAI,IAAG,KAAKd,EAAG,KAAK,CAACE,YAAY,aAAaJ,EAAIM,GAAIN,EAAIa,MAAM,SAASL,EAAIC,GAAO,OAAOP,EAAG,KAAK,CAACM,IAAIA,EAAIkB,MAAM,CAAC,OAAU1B,EAAI2B,eAAiBlB,GAAOgB,MAAM,CAAC,aAAahB,GAAOQ,GAAG,CAAC,WAAa,SAASC,GAAyD,OAAjDA,EAAOC,kBAAkBD,EAAOU,iBAAwB5B,EAAI6B,WAAWC,MAAM,KAAMC,UAAU,EAAE,UAAY,SAASb,GAAyD,OAAjDA,EAAOC,kBAAkBD,EAAOU,iBAAwB5B,EAAIgC,UAAUF,MAAM,KAAMC,UAAU,IAAI,CAAC/B,EAAIW,GAAGX,EAAIY,GAAGJ,KAAO,IAAG,GAAGN,EAAG,MAAM,CAACmB,WAAW,CAAC,CAACL,KAAK,OAAOM,QAAQ,SAASC,MAAwB,KAAjBvB,EAAIiC,SAAiBT,WAAW,oBAAoBnB,IAAI,WAAWD,YAAY,aAAa,CAACJ,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIiC,aAAa/B,EAAG,aAAa,CAACA,EAAG,gBAAgB,IAAI,EACl3C,EACIgC,EAAkB,G,8BCgCtB,GACAlB,KAAA,SACAmB,WAAA,CACAC,WAAAA,EAAAA,GAEAC,IAAAA,GACA,OACAxB,KAAA,GACAN,KAAA,GACA+B,UAAA,GACAX,aAAA,EACAY,aAAA,EACAC,YAAA,EACAC,QAAA,EAEA,EACAC,SAAA,CACAT,QAAAA,GACA,YAAAQ,SAAA,EACA,GAEA,KAAA5B,KAAA,KAAAc,aAEA,GAEAgB,QAAA,CACAC,QAAAA,CAAAnC,GACA,KAAAkB,aAAAlB,EACA,MAAAoC,EAAA,KAAAP,UAAA7B,GACA,KAAAqC,MAAAC,WAAAC,SAAA,GAAAH,EACA,EACAhB,UAAAA,CAAAoB,GACA,MAAAxC,EAAAyC,SAAAD,EAAAE,OAAAC,QAAA3C,OACA,KAAAmC,SAAAnC,GAEA,KAAA8B,aAAAU,EAAAI,QAAA,GAAAC,KACA,EACAtB,SAAAA,CAAAiB,GACA,KAAAT,YAAAS,EAAAI,QAAA,GAAAC,MACA,MAAAT,GAAA,KAAAL,YAAA,KAAAD,cAAAU,EAAAE,OAAAI,aAEA,IAAA9C,EAAAyC,SAAAD,EAAAE,OAAAC,QAAA3C,OAAA+C,KAAAC,MAAAZ,GACApC,EAAA,EACAA,EAAA,EACAA,EAAA,KAAAI,KAAA6C,OAAA,IACAjD,EAAA,KAAAI,KAAA6C,OAAA,GAEA,KAAAd,SAAAnC,EACA,EACAW,YAAAA,CAAAN,GACA,KAAA6C,QAAAC,KAAA,kBAAA9C,WACA,GAEA+C,OAAAA,IACAC,EAAAA,EAAAA,MAAAC,MAAA1B,IACA,KAAAxB,KAAAwB,EAAAxB,KACA,KAAAN,KAAA8B,EAAA9B,IAAA,IACAyD,OAAAC,IACAC,QAAAC,IAAAF,EAAA,GAEA,EACAG,OAAAA,GACA,KAAAtB,MAAAC,WAAAsB,WAAAC,IAGA,GAFA,KAAA7B,QAAA6B,EAEAA,GAAA,EACA,KAAA3C,aAAA,MADA,CAKA,QAAA4C,EAAA,EAAAA,EAAA,KAAAjC,UAAAoB,OAAA,EAAAa,IAAA,CACA,MAAAC,EAAA,KAAAlC,UAAAiC,GACAE,EAAA,KAAAnC,UAAAiC,EAAA,GACA,IAAAD,GAAAE,IAAAF,GAAAG,EAAA,CACA,KAAA9C,aAAA4C,EAEA,MAAAG,EAAAD,EAAAH,EACA,IAAAK,EAAA,EASA,GALAA,EAFAD,GAAA,GAAAA,GAAA,KAAAE,eAEAF,EAAA,KAAAE,eAGA,EAEAD,IAAA,KAAAA,gBACA,OAIA,OAFA,KAAAA,gBAAAA,OACA,KAAA7B,MAAAb,SAAA4C,MAAAC,UAAA,cAAAH,OAEA,CACA,CAEA,KAAAhD,aAAA,KAAAW,UAAAoB,OAAA,CA3BA,CA2BA,GAEA,EACAqB,MAAA,CACAxE,IAAAA,GACA,KAAAyE,WAAA,KACA,KAAAlC,MAAAmC,MAAAC,SAAAD,IACA,KAAA3C,UAAAsB,KAAAqB,EAAAE,UAAA,GACA,GAEA,EACAlD,QAAAA,GACA,KAAA+C,WAAA,KACA,KAAAJ,eAAA,KAAA9B,MAAAb,SAAAsB,YAAA,GAEA,IChJsP,I,UCQlP6B,GAAY,OACd,EACArF,EACAmC,GACA,EACA,KACA,WACA,MAIF,EAAekD,EAAiB,O","sources":["webpack://music163-vue/./src/views/singer.vue","webpack://music163-vue/src/views/singer.vue","webpack://music163-vue/./src/views/singer.vue?9546","webpack://music163-vue/./src/views/singer.vue?f326"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"singer\"},[_c('ScrollView',{ref:\"scrollView\"},[_c('ul',{staticClass:\"list-wrapper\"},_vm._l((_vm.list),function(key,index){return _c('li',{key:index,ref:\"group\",refInFor:true,staticClass:\"list-group\"},[_c('h2',{staticClass:\"group-title\"},[_vm._v(_vm._s(_vm.keys[index]))]),_c('ul',_vm._l((_vm.list[index]),function({id, img1v1Url, name}){return _c('li',{key:id,staticClass:\"group-item\",on:{\"click\":function($event){$event.stopPropagation();return _vm.switchSinger(id)}}},[_c('img',{directives:[{name:\"lazy\",rawName:\"v-lazy\",value:(img1v1Url),expression:\"img1v1Url\"}],attrs:{\"alt\":\"\"}}),_c('p',[_vm._v(_vm._s(name))])])}),0)])}),0)]),_c('ul',{staticClass:\"list-keys\"},_vm._l((_vm.keys),function(key,index){return _c('li',{key:key,class:{'active': _vm.currentIndex === index},attrs:{\"data-index\":index},on:{\"touchstart\":function($event){$event.stopPropagation();$event.preventDefault();return _vm.touchstart.apply(null, arguments)},\"touchmove\":function($event){$event.stopPropagation();$event.preventDefault();return _vm.touchmove.apply(null, arguments)}}},[_vm._v(_vm._s(key))])}),0),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.fixTitle !== ''),expression:\"fixTitle !== ''\"}],ref:\"fixTitle\",staticClass:\"fix-title\"},[_vm._v(_vm._s(_vm.fixTitle))]),_c('transition',[_c('router-view')],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"singer\">\r\n        <ScrollView ref=\"scrollView\">\r\n            <ul class=\"list-wrapper\">\r\n               <li class=\"list-group\" v-for=\"(key, index) in list\" :key=\"index\" ref=\"group\">\r\n                   <h2 class=\"group-title\">{{ keys[index] }}</h2>\r\n                   <ul>\r\n                       <li class=\"group-item\" v-for=\"{id, img1v1Url, name} in list[index]\" :key=\"id\" @click.stop=\"switchSinger(id)\">\r\n                           <img v-lazy=\"img1v1Url\" alt=\"\">\r\n                           <p>{{ name }}</p>\r\n                       </li>\r\n                   </ul>\r\n               </li>\r\n            </ul>\r\n        </ScrollView>\r\n        <ul class=\"list-keys\">\r\n            <li v-for=\"(key, index) in keys\"\r\n                :key=\"key\"\r\n                :data-index=\"index\"\r\n                @touchstart.stop.prevent=\"touchstart\"\r\n                @touchmove.stop.prevent=\"touchmove\"\r\n                :class=\"{'active': currentIndex === index}\">{{key}}</li>\r\n        </ul>\r\n        <div class=\"fix-title\" v-show=\"fixTitle !== ''\" ref=\"fixTitle\">{{fixTitle}}</div>\r\n        <transition>\r\n            <router-view></router-view>\r\n        </transition>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { getAllArtists } from '@/api'\r\nimport ScrollView from '@/components/ScrollView.vue'\r\n\r\nexport default {\r\n    name: 'singer',\r\n    components: {\r\n        ScrollView\r\n    },\r\n    data () {\r\n        return {\r\n            keys: [],\r\n            list: [],\r\n            groupsTop: [],\r\n            currentIndex: 0,\r\n            beginOffsetY: 0,\r\n            moveOffsetY: 0,\r\n            scrollY: 0\r\n        }\r\n    },\r\n    computed: {\r\n        fixTitle () {\r\n            if (this.scrollY >= 0) {\r\n                return ''\r\n            } else {\r\n                return this.keys[this.currentIndex]\r\n            }\r\n        }\r\n    },\r\n    methods: {\r\n        _keyDown (index) {\r\n            this.currentIndex = index\r\n            const offsetY = this.groupsTop[index]\r\n            this.$refs.scrollView.scrollTo(0, -offsetY)\r\n        },\r\n        touchstart (e) {\r\n            const index = parseInt(e.target.dataset.index)\r\n            this._keyDown(index)\r\n\r\n            this.beginOffsetY = e.touches[0].pageY\r\n        },\r\n        touchmove (e) {\r\n            this.moveOffsetY = e.touches[0].pageY\r\n            const offsetY = (this.moveOffsetY - this.beginOffsetY) / e.target.offsetHeight\r\n            // console.log(offsetY)\r\n            let index = parseInt(e.target.dataset.index) + Math.floor(offsetY)\r\n            if (index < 0) {\r\n                index = 0\r\n            } else if (index > this.keys.length - 1) {\r\n                index = this.keys.length - 1\r\n            }\r\n            this._keyDown(index)\r\n        },\r\n        switchSinger (id) {\r\n            this.$router.push(`/singer/detail/${id}/singer`)\r\n        }\r\n    },\r\n    created () {\r\n        getAllArtists().then(data => {\r\n            this.keys = data.keys\r\n            this.list = data.list\r\n        }).catch(err => {\r\n            console.log(err)\r\n        })\r\n    },\r\n    mounted () {\r\n        this.$refs.scrollView.scrolling((y) => {\r\n            this.scrollY = y\r\n            // 处理第一个区域\r\n            if (y >= 0) {\r\n                this.currentIndex = 0\r\n                return\r\n            }\r\n            // 处理中间区域\r\n            for (let i = 0; i < this.groupsTop.length - 1; i++) {\r\n                const preTop = this.groupsTop[i]\r\n                const nextTop = this.groupsTop[i + 1]\r\n                if (-y >= preTop && -y <= nextTop) {\r\n                    this.currentIndex = i\r\n                    // 1.用下一组标题的偏移位 + 当前滚动出去的偏移位\r\n                    const diffOffsetY = nextTop + y\r\n                    let fixTitleOffsetY = 0\r\n                    // 2.判断计算的结果是否是 0 ~ 分组标题高度的值\r\n                    if (diffOffsetY >= 0 && diffOffsetY <= this.fixTitleHeight) {\r\n                        // 满足条件开始移动上一组标题\r\n                        fixTitleOffsetY = diffOffsetY - this.fixTitleHeight\r\n                    } else {\r\n                        // 不满足条件需要固定在顶部\r\n                        fixTitleOffsetY = 0\r\n                    }\r\n                    if (fixTitleOffsetY === this.fixTitleOffsetY) {\r\n                        return\r\n                    }\r\n                    this.fixTitleOffsetY = fixTitleOffsetY\r\n                    this.$refs.fixTitle.style.transform = `translateY(${fixTitleOffsetY}px)`\r\n                    return\r\n                }\r\n            }\r\n            // 处理最后一个区域\r\n            this.currentIndex = this.groupsTop.length - 1\r\n        })\r\n    },\r\n    watch: {\r\n        list () {\r\n            this.$nextTick(() => {\r\n                this.$refs.group.forEach((group) => {\r\n                    this.groupsTop.push(group.offsetTop)\r\n                })\r\n            })\r\n        },\r\n        fixTitle () {\r\n            this.$nextTick(() => {\r\n                this.fixTitleHeight = this.$refs.fixTitle.offsetHeight\r\n            })\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n@import \"../assets/css/mixin\";\r\n.singer{\r\n    position: fixed;\r\n    top: 184px;\r\n    bottom: 0;\r\n    left: 0;\r\n    right: 0;\r\n    @include bg_sub_color();\r\n    overflow: hidden;\r\n    .list-wrapper{\r\n        list-style: none;\r\n        .group-title{\r\n            @include bg_color();\r\n            @include font_size($font_medium_s);\r\n            color: #fff;\r\n            padding: 10px 20px;\r\n            box-sizing: border-box;\r\n        }\r\n        .group-item{\r\n            display: flex;\r\n            justify-content: flex-start;\r\n            padding: 10px 20px;\r\n            border-bottom: 1px solid #ccc;\r\n            img{\r\n                width: 100px;\r\n                height: 100px;\r\n                border-radius: 50%;\r\n                overflow: hidden;\r\n            }\r\n            p{\r\n                @include font_size($font_medium);\r\n                @include font_color();\r\n                display: flex;\r\n                align-items: center;\r\n                margin-left: 20px;\r\n            }\r\n        }\r\n    }\r\n    .list-keys{\r\n        position: fixed;\r\n        right: 10px;\r\n        top: 60%;\r\n        transform: translateY(-50%);\r\n        li{\r\n            @include font_color();\r\n            @include font_size($font_medium_s);\r\n            padding: 3px 0;\r\n            &.active{\r\n                text-shadow: 0 0 10px #000;\r\n            }\r\n        }\r\n    }\r\n    .fix-title{\r\n        position: absolute;\r\n        left: 0;\r\n        right: 0;\r\n        top: 0;\r\n        padding: 10px 20px;\r\n        box-sizing: border-box;\r\n        @include font_size($font_medium);\r\n        color: #fff;\r\n        @include bg_color();\r\n    }\r\n}\r\n.v-enter{\r\n    transform: translateX(100%);\r\n}\r\n.v-enter-to{\r\n    transform: translateX(0%);\r\n}\r\n.v-enter-active{\r\n    transition: transform 0.5s;\r\n}\r\n.v-leave{\r\n    transform: translateX(0%);\r\n}\r\n.v-leave-to{\r\n    transform: translateX(100%);\r\n}\r\n.v-leave-active{\r\n    transition: transform 0.5s;\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./singer.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./singer.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./singer.vue?vue&type=template&id=e683a788&scoped=true&\"\nimport script from \"./singer.vue?vue&type=script&lang=js&\"\nexport * from \"./singer.vue?vue&type=script&lang=js&\"\nimport style0 from \"./singer.vue?vue&type=style&index=0&id=e683a788&prod&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"e683a788\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","ref","_l","list","key","index","refInFor","_v","_s","keys","id","img1v1Url","name","on","$event","stopPropagation","switchSinger","directives","rawName","value","expression","attrs","class","currentIndex","preventDefault","touchstart","apply","arguments","touchmove","fixTitle","staticRenderFns","components","ScrollView","data","groupsTop","beginOffsetY","moveOffsetY","scrollY","computed","methods","_keyDown","offsetY","$refs","scrollView","scrollTo","e","parseInt","target","dataset","touches","pageY","offsetHeight","Math","floor","length","$router","push","created","getAllArtists","then","catch","err","console","log","mounted","scrolling","y","i","preTop","nextTop","diffOffsetY","fixTitleOffsetY","fixTitleHeight","style","transform","watch","$nextTick","group","forEach","offsetTop","component"],"sourceRoot":""}